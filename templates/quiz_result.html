{% extends "base.html" %}
{% block title %}Káº¿t quáº£ - MANI Learning Hub{% endblock %}
{% block content %}
<a href="{{ url_for('course_detail',cid=course['id']) }}" class="btn btn-outline btn-sm" style="margin-bottom:14px">â† Quay láº¡i</a>
<div class="card" style="text-align:center;padding:36px">
    <div style="font-size:56px;margin-bottom:8px">{% if result['passed'] %}ğŸ‰{% else %}ğŸ˜”{% endif %}</div>
    <h2 style="color:{% if result['passed'] %}var(--success){% else %}var(--danger){% endif %};margin-bottom:6px">{% if result['passed'] %}ChÃºc má»«ng! Báº¡n Ä‘Ã£ Ä‘áº¡t!{% else %}ChÆ°a Ä‘áº¡t Ä‘iá»ƒm yÃªu cáº§u{% endif %}</h2>
    <p style="font-size:32px;font-weight:700;color:var(--primary);margin:10px 0">{{ result['score'] }}/{{ result['total'] }}</p>
    <p style="color:#666;font-size:13px">Äiá»ƒm Ä‘áº¡t: {{ course['pass_score'] }} | LÆ°á»£t: {{ result['attempt_number'] or 1 }}/{{ course['max_attempts'] or 3 }}</p>
    <div style="max-width:250px;margin:14px auto"><div class="progress-bar"><div class="progress-fill" style="width:{{ (result['score']/result['total']*100)|round }}%;background:{% if result['passed'] %}var(--success){% else %}var(--danger){% endif %}"></div></div></div>
    {% if result['passed'] %}
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:14px">
        <a href="{{ url_for('download_cert',cid=course['id'],rid=result['id']) }}" target="_blank" class="btn btn-primary">ğŸ“œ Xem/Táº£i chá»©ng chá»‰</a>
        <form method="POST" action="{{ url_for('send_cert_email',cid=course['id'],rid=result['id']) }}" style="display:inline">
            <button type="submit" class="btn btn-secondary">ğŸ“§ Gá»­i qua email</button>
        </form>
    </div>
    {% else %}
    {% set remaining = (course['max_attempts'] or 3) - (attempt_info.attempt_count if attempt_info else 1) %}
    {% if remaining > 0 %}
    <a href="{{ url_for('take_quiz',cid=course['id']) }}" class="btn btn-secondary" style="margin-top:14px">ğŸ”„ Thá»­ láº¡i (cÃ²n {{ remaining }} lÆ°á»£t)</a>
    {% else %}
    <p style="color:var(--danger);font-size:13px;margin-top:14px">ÄÃ£ háº¿t lÆ°á»£t. LiÃªn há»‡ Trainer Ä‘á»ƒ lÃ m láº¡i.</p>
    {% endif %}
    {% endif %}
</div>
<h3 style="color:var(--primary);font-size:16px;margin:20px 0 12px">ğŸ“‹ Chi tiáº¿t cÃ¢u tráº£ lá»i</h3>
{% for q in questions %}
{% set ua=answers.get(q['id']|string,'') %}{% set ok=ua==q['answer'] %}
<div class="card" style="border-left:4px solid {% if ok %}var(--success){% else %}var(--danger){% endif %};padding:14px 16px">
    <p style="font-weight:600;font-size:13px;margin-bottom:6px">{{ loop.index }}. {{ q['text'] }}</p>
    <p style="font-size:12px;color:{% if ok %}var(--success){% else %}var(--danger){% endif %}">Tráº£ lá»i: {% if ua %}{% if ua=='a' %}{{ q['option_a'] }}{% elif ua=='b' %}{{ q['option_b'] }}{% elif ua=='c' %}{{ q['option_c'] }}{% else %}{{ q['option_d'] }}{% endif %} {% if ok %}âœ“{% else %}âœ—{% endif %}{% else %}(Bá» qua) âœ—{% endif %}</p>
    {% if not ok %}<p style="font-size:12px;color:var(--success)">ÄÃ¡p Ã¡n: {% if q['answer']=='a' %}{{ q['option_a'] }}{% elif q['answer']=='b' %}{{ q['option_b'] }}{% elif q['answer']=='c' %}{{ q['option_c'] }}{% else %}{{ q['option_d'] }}{% endif %}</p>{% endif %}
    {% if q['explanation'] %}<p style="font-size:11px;color:#888;font-style:italic;margin-top:3px">ğŸ’¡ {{ q['explanation'] }}</p>{% endif %}
</div>
{% endfor %}
{% endblock %}
