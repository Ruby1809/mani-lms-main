<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MANI Learning Hub{% endblock %}</title>
    <link rel="icon" href="https://lh3.googleusercontent.com/d/1KH0xWe9JoWkmSb2fhYvtfr8kmUN7Ggcj" type="image/png">
    <style>
        :root{--primary:#003047;--secondary:#3A7595;--yellow:#FFE100;--bg:#F2F2F2;--white:#FFF;--danger:#DC3545;--success:#28A745;--gray:#6c757d}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Roboto,sans-serif;background:var(--bg);color:#333;min-height:100vh}
        a{color:var(--secondary);text-decoration:none}a:hover{text-decoration:underline}
        .header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:0 16px;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(0,0,0,.15)}
        .header-left{display:flex;align-items:center;gap:10px}.header-left img{height:32px;border-radius:4px}.header-left h1{font-size:16px;font-weight:700}
        .header-right{display:flex;align-items:center;gap:10px;font-size:12px}
        .avatar-sm{width:30px;height:30px;border-radius:50%;background:var(--yellow);color:var(--primary);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;cursor:pointer;overflow:hidden}
        .avatar-sm img{width:100%;height:100%;object-fit:cover}
        .header-right .uinfo{text-align:right}.header-right .uname{font-weight:600}.header-right .urole{opacity:.7;font-size:10px}
        .btn-white{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.4);padding:5px 12px;font-size:11px;border-radius:8px;cursor:pointer}
        .nav-bar{background:var(--primary);padding:0 12px;display:flex;gap:2px;overflow-x:auto;-webkit-overflow-scrolling:touch}
        .nav-bar::-webkit-scrollbar{display:none}
        .nav-bar a{color:rgba(255,255,255,.7);padding:10px 14px;font-size:12px;font-weight:500;white-space:nowrap;border-bottom:3px solid transparent;transition:all .2s}
        .nav-bar a:hover,.nav-bar a.active{color:#fff;border-bottom-color:var(--yellow);text-decoration:none;background:rgba(255,255,255,.05)}
        .cat-bar{background:#fff;padding:8px 12px;display:flex;gap:6px;overflow-x:auto;border-bottom:1px solid #eee;-webkit-overflow-scrolling:touch}.cat-bar::-webkit-scrollbar{display:none}
        .cat-chip{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;white-space:nowrap;border:2px solid #ddd;color:#555;transition:all .2s;cursor:pointer}
        .cat-chip:hover,.cat-chip.active{border-color:var(--yellow);background:var(--yellow);color:var(--primary);text-decoration:none}
        .search-bar{background:#fff;padding:8px 12px;border-bottom:1px solid #eee}.search-bar form{display:flex;gap:8px;max-width:600px}
        .search-bar input{flex:1;padding:8px 14px;border:1px solid #ddd;border-radius:8px;font-size:13px;outline:none}.search-bar input:focus{border-color:var(--secondary)}
        .search-bar button{padding:8px 16px;background:var(--primary);color:#fff;border:none;border-radius:8px;font-size:13px;cursor:pointer}
        .container{max-width:1100px;margin:0 auto;padding:20px 14px}
        .card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:14px}
        .card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
        .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;text-decoration:none}.btn:hover{opacity:.9;text-decoration:none}
        .btn-primary{background:var(--yellow);color:var(--primary)}.btn-secondary{background:var(--secondary);color:#fff}
        .btn-danger{background:var(--danger);color:#fff}.btn-outline{background:transparent;color:var(--primary);border:2px solid var(--primary)}
        .btn-success{background:var(--success);color:#fff}.btn-sm{padding:5px 12px;font-size:11px}
        .form-group{margin-bottom:12px}.form-group label{display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:3px}
        .form-control{width:100%;padding:9px 12px;border:1px solid #ddd;border-radius:8px;font-size:13px;outline:none;transition:border .2s}
        .form-control:focus{border-color:var(--secondary);box-shadow:0 0 0 3px rgba(58,117,149,.1)}
        select.form-control{background:#fff}textarea.form-control{min-height:70px;resize:vertical}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .checkbox-group{display:flex;flex-wrap:wrap;gap:10px;margin-top:4px}
        .checkbox-group label{display:flex;align-items:center;gap:4px;font-size:12px;cursor:pointer;font-weight:400}
        .tag{display:inline-block;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;background:rgba(58,117,149,.15);color:var(--secondary)}
        .badge{display:inline-block;padding:3px 10px;border-radius:16px;font-size:11px;font-weight:600}
        .badge-success{background:rgba(40,167,69,.15);color:var(--success)}.badge-danger{background:rgba(220,53,69,.15);color:var(--danger)}
        .badge-warning{background:rgba(255,193,7,.15);color:#856404}.badge-info{background:rgba(58,117,149,.15);color:var(--secondary)}
        .badge-admin{background:rgba(220,53,69,.15);color:var(--danger)}.badge-trainer{background:rgba(58,117,149,.15);color:var(--secondary)}.badge-learner{background:rgba(40,167,69,.15);color:var(--success)}
        .table-wrap{overflow-x:auto}table{width:100%;border-collapse:collapse;font-size:13px}
        th{padding:10px 14px;background:var(--primary);color:#fff;text-align:left;font-weight:600;font-size:12px}
        td{padding:8px 14px;border-bottom:1px solid #eee}tr:hover td{background:#fafafa}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:20px}
        .stat-card{text-align:center;padding:20px;background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
        .stat-card .emoji{font-size:28px}.stat-card .num{font-size:32px;font-weight:700;color:var(--primary)}.stat-card .label{font-size:12px;color:#666;margin-top:2px}
        .progress-bar{height:8px;background:#E0E0E0;border-radius:4px;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--secondary),var(--yellow));border-radius:4px;transition:width .5s}
        .banner{background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:14px;padding:28px;color:#fff;margin-bottom:20px;position:relative;overflow:hidden}
        .banner::after{content:'';position:absolute;right:-40px;top:-40px;width:180px;height:180px;border-radius:50%;background:rgba(255,225,0,.1)}
        .banner h2{font-size:22px;margin-bottom:6px}.banner p{opacity:.85;font-size:14px}
        .banner-stats{display:flex;gap:20px;margin-top:16px;flex-wrap:wrap}.banner-stats div span:first-child{font-size:24px;font-weight:700}.banner-stats div span:last-child{font-size:11px;opacity:.7}
        .flash{padding:10px 16px;border-radius:8px;margin-bottom:14px;font-size:13px;font-weight:500}
        .flash-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
        .flash-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
        .flash-warning{background:#fff3cd;color:#856404;border:1px solid #ffeeba}
        .course-card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.06);border-top:4px solid var(--secondary);transition:transform .2s,box-shadow .2s;cursor:pointer;display:block;color:inherit}
        .course-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.12);text-decoration:none;color:inherit}
        .course-card h4{color:var(--primary);margin:6px 0;font-size:15px}.course-card .meta{display:flex;justify-content:space-between;font-size:11px;color:#888;margin-top:10px}
        .course-card.passed{border-top-color:var(--success)}
        .tabs{display:flex;background:#fff;border-radius:10px;padding:4px;margin-bottom:16px;gap:4px;overflow-x:auto}
        .tabs a{flex:1;padding:8px;text-align:center;border-radius:8px;font-size:12px;font-weight:600;color:#666;transition:all .2s;white-space:nowrap}
        .tabs a:hover{background:#f5f5f5;text-decoration:none}.tabs a.active{background:var(--primary);color:#fff}
        .quiz-option{padding:12px 16px;border:2px solid #E0E0E0;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all .2s;margin-bottom:8px}
        .quiz-option:hover{border-color:var(--secondary)}.quiz-option.selected{border-color:var(--yellow);background:rgba(255,225,0,.08)}
        .quiz-option input[type=radio]{display:none}
        .quiz-option .letter{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#F0F0F0;font-weight:700;font-size:12px;flex-shrink:0}
        .quiz-option.selected .letter{background:var(--yellow);color:var(--primary)}
        .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;padding:16px;align-items:center;justify-content:center}
        .modal-overlay.show{display:flex}.modal-box{background:#fff;border-radius:14px;padding:28px;max-width:600px;width:100%;max-height:85vh;overflow:auto}
        .drop-zone{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;cursor:pointer;transition:all .2s;background:#fafafa}
        .drop-zone.dragover{border-color:var(--yellow);background:rgba(255,225,0,.08)}.drop-zone p{color:#888;font-size:13px;margin:0}
        @media(max-width:768px){.form-row{grid-template-columns:1fr}.header-right .uinfo{display:none}.banner h2{font-size:18px}.nav-bar a{padding:8px 10px;font-size:11px}.container{padding:14px 10px}}
        @media print{.no-print{display:none!important}body{background:#fff}}
    </style>
</head>
<body>
    {% if session.get('user_email') %}
    <header class="header no-print">
        <div class="header-left">
            <img src="https://lh3.googleusercontent.com/d/1KH0xWe9JoWkmSb2fhYvtfr8kmUN7Ggcj" alt="MANI" onerror="this.style.display='none'">
            <h1>MANI Learning Hub</h1>
        </div>
        <div class="header-right">
            <div class="uinfo"><div class="uname">{{ session.get('user_name','') }}</div><div class="urole">{{ session.get('user_role','') }}</div></div>
            <a href="{{ url_for('profile') }}" class="avatar-sm" title="H·ªì s∆°">
                {% set cu = get_current_user() if get_current_user is defined else None %}
                {% if cu and cu['avatar_url'] %}<img src="{{ cu['avatar_url'] }}" alt="">{% else %}{{ session.get('user_name','?')[0] }}{% endif %}
            </a>
            <a href="{{ url_for('logout') }}" class="btn-white">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>
    <nav class="nav-bar no-print">
        <a href="{{ url_for('dashboard') }}" class="{{ 'active' if request.endpoint=='dashboard' }}">üè† Trang ch·ªß</a>
        <a href="{{ url_for('my_certs') }}" class="{{ 'active' if request.endpoint=='my_certs' }}">üèÜ Ch·ª©ng ch·ªâ</a>
        <a href="{{ url_for('profile') }}" class="{{ 'active' if request.endpoint=='profile' }}">üë§ H·ªì s∆°</a>
        {% if session.get('user_role') in ('admin','trainer') %}
        <a href="{{ url_for('admin_panel') }}" class="{{ 'active' if request.endpoint=='admin_panel' }}">‚öôÔ∏è Qu·∫£n tr·ªã</a>
        <a href="{{ url_for('analytics') }}" class="{{ 'active' if request.endpoint=='analytics' }}">üìä Th·ªëng k√™</a>
        {% endif %}
    </nav>
    <div class="cat-bar no-print">
        <a href="{{ url_for('dashboard') }}" class="cat-chip {{ 'active' if request.endpoint=='dashboard' }}">üìã T·∫•t c·∫£</a>
        {% for cat in categories %}<a href="{{ url_for('browse_category', cat=cat) }}" class="cat-chip {{ 'active' if request.endpoint=='browse_category' and request.view_args.get('cat')==cat }}">{% if cat=='Compliance' %}üìú{% elif cat=='SOP' %}üìë{% elif cat=='Product Training' %}üè•{% elif cat=='Skills Training' %}üéØ{% else %}üìö{% endif %} {{ cat }}</a>{% endfor %}
    </div>
    <div class="search-bar no-print">
        <form action="{{ url_for('search_courses') }}" method="GET"><input type="text" name="q" placeholder="üîç T√¨m ki·∫øm kh√≥a h·ªçc..." value="{{ request.args.get('q','') }}"><button type="submit">T√¨m</button></form>
    </div>
    {% endif %}
    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}{% if messages %}{% for cat, msg in messages %}<div class="flash flash-{{ cat }}">{{ msg }}</div>{% endfor %}{% endif %}{% endwith %}
        {% block content %}{% endblock %}
    </div>
</body>
</html>
